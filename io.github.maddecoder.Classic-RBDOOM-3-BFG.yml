app-id: io.github.maddecoder.Classic-RBDOOM-3-BFG
runtime: org.freedesktop.Platform
sdk: org.freedesktop.Sdk
runtime-version: "25.08"
command: DOOMBFA.sh
build-options:
    append-path: /usr/lib/sdk/mono6/bin
    append-ld-library-path: /usr/lib/sdk/mono6/lib
    append-pkg-config-path: /usr/lib/sdk/mono6/lib/pkgconfig

finish-args:
- --device=all
- --socket=wayland
- --socket=x11
- --share=ipc
- --share=network
- --socket=pulseaudio
- --filesystem=~/.var/app/com.valvesoftware.Steam:ro
- --filesystem=~/.var/app/net.lutris.Lutris:ro
- --filesystem=~/.var/app/com.heroicgameslauncher.hgl:ro
- --persist=.doombfa
- --filesystem=home:ro
- --filesystem=/run/media:ro
- --filesystem=/media:ro
- --filesystem=/mnt:ro
# Simpler way of preventing KDE related errors
- --env=KDE_FULL_SESSION=false

cleanup:
- /include
- /lib/*.a
- /lib/*.la
- /lib/pkgconfig
- /lib/cmake
- /share/man
- /share/doc
- /share/ffmpeg
- /bin/al*
- /bin/openal*
- /lib/cmake/OpenAL

modules:

- name: FFMPEG
  no-autogen: true  
  config-opts:
   - --disable-x86asm
   - --enable-shared
   - --disable-large-tests
   - --enable-linux-perf
   - --disable-debug
   - --disable-programs
   - --quiet
  sources:
  - type: git
    url: https://github.com/FFmpeg/FFmpeg.git
    tag: n7.1.2
    commit: f893221c8d89cb798b829bebe71d55e1a3f242fd
- name: OpenAL-Soft
  buildsystem: cmake-ninja
  no-autogen: true
  config-opts:
   - -DCMAKE_BUILD_TYPE=Release
  sources:
  - type: git
    url: https://github.com/kcat/openal-soft.git
    tag: "1.24.3"
    commit: dc7d7054a5b4f3bec1dc23a42fd616a0847af948

- name: DoomBFA
  buildsystem: cmake-ninja
  subdir: neo
  builddir: true
  no-make-install: true
  config-opts:
   - --preset=linux-retail
   - -B .
   - -DMAKE_DLL=OFF
   - -DPACKAGED=ON
   - -DUSE_VCPKG=OFF
   - -DALL_STATIC=OFF
   - -DFFMPEG_FOUND=true
   - -DFFMPEG_AVCODEC_INCLUDE_DIR=/app/include
   - -DFFMPEG_LIBAVCODEC=/app/lib/libavcodec.so
   - -DFFMPEG_LIBAVFORMAT=/app/lib/libavformat.so
   - -DFFMPEG_LIBAVUTIL=/app/lib/libavutil.so
   - -DFFMPEG_LIBSWRESAMPLE=/app/lib/libswresample.so
   - -DFFMPEG_LIBSWSCALE=/app/lib/libswscale.so
   - -DOPENAL_FOUND=true
   - -DOPENAL_INCLUDE_DIR=/app/include
   - -DOPENAL_LIBRARY=/app/lib/libopenal.so
   - -DOPENAL_VERSION_STRING=1.24.3
   - -DUSE_SYSTEM_LIBPNG=false
   - -DUSE_SYSTEM_RAPIDJSON=false
   - -DUSE_OPENXR=OFF
  sources:
  - type: git
    url: https://github.com/MadDeCoDeR/Classic-RBDOOM-3-BFG.git
    tag: "nightly-2025-11-01-09-12-1761988340"
    commit: 7a4a3ec9d4d35dcaf602acbeb879c6ca071fec4c
    disable-submodules: true
  modules:
    - shared-modules/glew/glew.json
    - shared-modules/glu/glu-9.json
  build-commands:
    - install -Dm 755 DoomBFA /app/bin/DoomBFA
    - mkdir -p /app/share/games/doombfa
    - cp -R ../../base /app/share/games/doombfa/base
    - cp -R ../../base_new /app/share/games/doombfa/base_NEW
    - cp ../../alsoft.conf /app/share/games/doombfa/alsoft.conf
    - rm /app/share/games/doombfa/base/generate_zBFA_s1.cfg
    - rm /app/share/games/doombfa/base/generate_zBFA_s2.cfg
    - rm /app/share/games/doombfa/base/DoomBFA.sh
    - rm -r /app/share/games/doombfa/base/renderprogs

- name: DoomBFA-assets
  buildsystem: simple
  sources:
  - type: extra-data
    filename: BFA-Assets.zip
    url: https://github.com/MadDeCoDeR/BFA-Assets/archive/refs/heads/main.zip
    sha256: 180ad9a7b0593b02ec86d61a7c39c3261713c9ed0c800c0f05fac99dc1b6dc1b
    size: 178229
    x-checker-data:
      type: json
      url:  https://api.github.com/repos/MadDeCoDeR/BFA-Assets/releases/latest
      tag-query: .tag_name
      version-query: $tag
      timestamp-query: .published_at
      url-query: .assets[] | .browser_download_url
  - type: file
    path: Classic-RBDOOM-3-BFG.appdata.xml
  - type: file
    path: DOOMBFA.desktop
  - type: file
    path: doom.png
  - type: file
    path: DOOMBFA.sh
  - type: file
    path: apply_extra.sh
  build-commands:
    - install -Dm 644 DOOMBFA.desktop /app/share/applications/${FLATPAK_ID}.desktop
    - install -Dm 644 doom.png /app/share/icons/hicolor/128x128/apps/${FLATPAK_ID}.png
    - install -Dm 755 apply_extra.sh /app/bin/apply_extra
    - install -Dm 644 Classic-RBDOOM-3-BFG.appdata.xml /app/share/metainfo/${FLATPAK_ID}.metainfo.xml
    - install -Dm 755 DOOMBFA.sh /app/bin/DOOMBFA.sh

    
